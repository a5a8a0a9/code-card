<div class="h-full w-full flex flex-col bg-slate-950 overflow-hidden">
	<!-- [Card Display Area] - Flex-1, Draggable -->
	<div
		class="flex-1 relative perspective-container flex items-center justify-center overflow-hidden"
		style="touch-action: none"
		(pointerdown)="onPointerDown($event)"
		(pointermove)="onPointerMove($event)"
		(pointerup)="onPointerUp($event)"
		(pointercancel)="onPointerUp($event)"
	>
		<!-- Background Grid -->
		<div
			class="absolute inset-0 z-0 opacity-20 pointer-events-none"
			style="
				background-image: linear-gradient(#334155 1px, transparent 1px),
					linear-gradient(90deg, #334155 1px, transparent 1px);
				background-size: 16px 16px;
			"
		></div>

		<!-- Scaling Container -->
		<div
			class="relative transition-transform duration-300 ease-out"
			[style.transform]="'scale(' + scale() + ')'"
		>
			<!-- 3D Card Body -->
			<div
				class="card-3d relative w-[320px] h-[480px] sm:w-[380px] sm:h-[560px] transition-transform duration-100 ease-linear cursor-grab active:cursor-grabbing select-none z-20"
				[style.transform]="getCardTransform()"
			>
				<!-- Front: IDE JSON Interface -->
				<div
					class="absolute inset-0 backface-hidden bg-[#1e1e1e] rounded-xl shadow-2xl border border-slate-700 overflow-hidden flex flex-col"
				>
					<!-- IDE Header -->
					<div
						class="h-9 bg-[#252526] flex items-center px-3 border-b border-[#111] space-x-2"
					>
						<div class="flex space-x-1.5">
							<div class="w-3 h-3 rounded-full bg-red-500"></div>
							<div class="w-3 h-3 rounded-full bg-yellow-500"></div>
							<div class="w-3 h-3 rounded-full bg-green-500"></div>
						</div>
						<div
							class="ml-4 flex items-center bg-[#1e1e1e] px-3 py-1 rounded-t text-xs text-slate-300 border-t border-blue-500"
						>
							<span class="text-blue-400 mr-1.5">{{ "{}" }}</span>
							profile.json
							<span class="ml-2 hover:text-white cursor-pointer">×</span>
						</div>
					</div>

					<!-- IDE Body (Code Area) -->
					<div
						class="flex-1 p-4 font-mono text-sm leading-6 overflow-hidden relative"
					>
						<!-- Line Numbers -->
						<div
							class="absolute left-0 top-4 bottom-0 w-8 text-right pr-2 text-slate-600 select-none text-xs leading-6"
						>
							@for (i of lineNumbers; track i) {
							<div>{{ i }}</div>
							}
						</div>

						<!-- Code Content -->
						<div class="pl-8 h-full flex flex-col items-start">
							<div class="whitespace-nowrap">
								<span class="text-yellow-400">{{ "{" }}</span>
							</div>

							<div class="pl-4 flex flex-col items-start w-full">
								<div class="whitespace-nowrap">
									<span class="text-sky-300">"name"</span>:
									<span class="text-orange-300"
										>"{{ cardService.profile().name || "User" }}"</span
									><span class="text-slate-400">,</span>
								</div>

								<div class="whitespace-nowrap">
									<span class="text-sky-300">"title"</span>:
									<span class="text-orange-300"
										>"{{ cardService.profile().title || "Developer" }}"</span
									><span class="text-slate-400">,</span>
								</div>

								<div class="whitespace-nowrap">
									<span class="text-sky-300">"email"</span>:
									<span class="text-orange-300"
										>"{{ cardService.profile().email }}"</span
									><span class="text-slate-400">,</span>
								</div>
								<div class="whitespace-nowrap">
									<span class="text-sky-300">"phone"</span>:
									<span class="text-orange-300"
										>"{{ cardService.profile().phone }}"</span
									><span class="text-slate-400">,</span>
								</div>

								<!-- <div class="whitespace-nowrap">
									<span class="text-sky-300">"contact"</span>:
									<span class="text-yellow-400">{{ "{" }}</span>
								</div>
								<div class="pl-4 flex flex-col items-start w-full"></div>
								<div class="whitespace-nowrap">
									<span class="text-yellow-400">{{ "}" }}</span
									><span class="text-slate-400">,</span>
								</div> -->

								<!-- Skills Block -->
								<div class="whitespace-nowrap">
									<span class="text-sky-300">"skills"</span>:
									<span class="text-purple-400">[</span>
								</div>
								<div class="pl-4 flex flex-wrap gap-x-1 w-full">
									@for (skill of cardService.skillList(); track skill; let last
									= $last) {
									<span>
										<span class="text-orange-300">"{{ skill }}"</span>@if
										(!last) {
										<span class="text-slate-400">,</span>
										}
									</span>
									}
								</div>
								<div class="whitespace-nowrap">
									<span class="text-purple-400">]</span
									><span class="text-slate-400">,</span>
								</div>

								<div class="whitespace-nowrap">
									<span class="text-sky-300">"status"</span>:
									<span class="text-blue-400">"Open to work"</span>
								</div>

								<div class="whitespace-nowrap">
									<span class="text-green-600/80 italic text-xs"
										>// TODO: Make something awesome</span
									>
								</div>
							</div>

							<div class="whitespace-nowrap">
								<span class="text-yellow-400">{{ "}" }}</span>
								<span
									class="animate-pulse inline-block w-2 h-4 ml-1 bg-slate-400 align-middle"
								></span>
							</div>
						</div>
					</div>

					<!-- IDE Footer -->
					<div
						class="h-6 bg-[#007acc] text-white text-[10px] flex items-center px-2 justify-between"
					>
						<div class="flex items-center gap-3">
							<span>master*</span>
							<span>&#x2297; 0 &#x26A0; 0</span>
						</div>
						<div class="flex items-center gap-3">
							<span>Ln 14, Col 2</span>
							<span>UTF-8</span>
							<span>JSON</span>
						</div>
					</div>
				</div>

				<!-- Back: Metal Texture Design -->
				<div
					class="absolute inset-0 backface-hidden rotate-y-180 rounded-xl shadow-2xl overflow-hidden border border-slate-600/50"
				>
					<!-- Metal Gradient Background -->
					<div
						class="absolute inset-0 bg-gradient-to-br from-slate-300 via-slate-100 to-slate-400"
					></div>

					<!-- Noise Overlay -->
					<div
						class="absolute inset-0 opacity-50 mix-blend-multiply"
						style="
							filter: contrast(120%) brightness(100%);
							background: radial-gradient(
								circle at 50% 0,
								rgba(255, 255, 255, 0.8),
								transparent 70%
							);
						"
					></div>

					<!-- Decor Lines -->
					<div class="absolute inset-0">
						<div
							class="absolute top-10 right-10 w-40 h-40 border-[1px] border-slate-400/30 rounded-full"
						></div>
						<div
							class="absolute bottom-20 left-10 w-60 h-60 border-[1px] border-slate-800/10 rounded-full"
						></div>

						<!-- Diagonal Cut -->
						<div
							class="absolute top-0 right-0 w-full h-full bg-gradient-to-bl from-white/40 via-transparent to-transparent"
						></div>

						<div
							class="absolute inset-0 flex items-center justify-center opacity-10"
						>
							<svg
								class="w-48 h-48 text-slate-800"
								viewBox="0 0 24 24"
								fill="currentColor"
							>
								<path
									d="M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 8.5l-2.5 1.25L12 11zm0 2.5l-5-2.5-5 2.5L12 22l10-8.5-5-2.5-5 2.5z"
								/>
							</svg>
						</div>
					</div>

					<!-- Back Info -->
					<div class="absolute bottom-8 left-8 right-8 text-slate-800">
						<div
							class="text-3xl font-black tracking-tighter uppercase opacity-80 mix-blend-color-burn"
						>
							{{ cardService.profile().name || "DEV MEMBER" }}
						</div>
						<div class="h-1 w-12 bg-slate-800 mt-2 mb-2"></div>
						<div
							class="text-xs font-bold tracking-[0.2em] uppercase opacity-60"
						>
							{{ cardService.profile().title || "SYSTEM ARCHITECT" }}
						</div>

						<div class="mt-6 flex justify-between items-end opacity-70">
							<div
								class="text-[10px] font-mono border border-slate-800 px-2 py-1 rounded-sm"
							>
								ID: 8X-{{ (cardService.profile().name || "000").length * 123 }}
							</div>
							<div class="w-12 h-12 bg-slate-800 p-1">
								<div
									class="w-full h-full bg-white grid grid-cols-4 grid-rows-4 gap-px"
								>
									<div class="bg-slate-800 col-span-2 row-span-2"></div>
									<div class="bg-slate-800 col-start-4 row-start-1"></div>
									<div class="bg-slate-800 col-start-1 row-start-4"></div>
									<div class="bg-slate-800 col-start-3 row-start-3"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Interaction Hint -->
		<div
			class="absolute top-6 left-0 right-0 text-center pointer-events-none opacity-50 text-slate-400 text-xs tracking-widest uppercase animate-pulse"
		>
			拖曳卡片來旋轉
		</div>
	</div>

	<!-- [Action Area] - Static, Actions -->
	<div
		class="h-20 bg-slate-900 border-t border-slate-800 flex items-center justify-center gap-6 z-50 shrink-0 shadow-[0_-5px_15px_rgba(0,0,0,0.3)]"
	>
		<!-- Reset View -->
		<button
			type="button"
			(click)="cardService.resetRotation()"
			class="w-12 h-12 bg-slate-800 text-slate-200 hover:bg-slate-700 rounded-full flex items-center justify-center transition-all hover:scale-105 active:scale-95 text-xl border border-slate-700 shadow-md"
			title="重置視角"
		>
			<fa-icon [icon]="faRotateRight"></fa-icon>
		</button>

		<!-- Auto Rotate -->
		<button
			type="button"
			(click)="cardService.toggleAutoRotate()"
			class="w-12 h-12 bg-slate-800 text-slate-200 hover:bg-slate-700 rounded-full flex items-center justify-center transition-all hover:scale-105 active:scale-95 text-xl border border-slate-700 shadow-md"
			[title]="cardService.isAutoRotating() ? '停止旋轉' : '自動旋轉'"
			[class.text-cyan-400]="cardService.isAutoRotating()"
		>
			@if (cardService.isAutoRotating()) {
			<!-- Pause -->
			<fa-icon [icon]="faPause"></fa-icon>
			} @else {
			<!-- Play -->
			<fa-icon [icon]="faPlay" class="pl-1"></fa-icon>
			}
		</button>

		<!-- Edit FAB (Mobile) - Now consistent style -->
		<button
			type="button"
			(click)="cardService.setEditingMode(true)"
			class="w-12 h-12 bg-cyan-600 text-white hover:bg-cyan-500 rounded-full flex items-center justify-center transition-all hover:scale-105 active:scale-95 text-xl shadow-lg lg:hidden"
			title="編輯名片"
		>
			<fa-icon [icon]="faPen"></fa-icon>
		</button>
	</div>
</div>
